package actions;

import java.util.Map;

import com.mysql.jdbc.ResultSet;
import com.opensymphony.xwork2.ActionContext;
import com.opensymphony.xwork2.ActionSupport;

import connection.Connect;
import models.ke_hoach;

public class QLDVNFindSVAction extends ActionSupport {

	private static final long serialVersionUID = 1L;
	private Map<String, Object> session = null;
	private QLDVNAction qlnAction = null;

	public QLDVNFindSVAction() {
	}
	
	public String execute(){
		this.qlnAction = new QLDVNAction();
		this.session = ActionContext.getContext().getSession();
		if(!this.qlnAction.Prefix_Check("Tìm sinh viên cần nhập điểm",this.session))
			return ERROR;
		return SUCCESS;
	}
	
	public void assignKHThongKeValues(Map<String, Object> session) {
		this.conn = new Connect();
		String procedure = "call get_tt_kh_thong_ke();";
		ke_hoach khtk = new ke_hoach();
		try {
			ResultSet rs = this.conn.call_procedure(procedure);
			if (rs.next()) {
				khtk.setNk(rs.getString("NK"));
				khtk.setHk(rs.getInt("HK"));
				khtk.setLoai(rs.getInt("LOAI"));
				khtk.setNgay_bd(rs.getString("BD"));
				khtk.setNgay_kt(rs.getString("KT"));
			}
			// Đóng kết nối
			rs.close();
			this.conn.Close();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		// Thêm vào session
		session.put("ke_hoach_thong_ke", khtk);
	}
}
